/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Toolbar","./Button","./SuggestionsList","./SuggestionItem","sap/ui/Device","sap/m/library","sap/ui/core/Core","sap/ui/core/InvisibleText"],function(e,t,n,i,s,o,r,a,u){"use strict";var c=r.PlacementType;function l(l){var p=l,f,d,g,h=o.system.phone,m=this;e.sap.require(h?"sap.m.Dialog":"sap.m.Popover");function v(e){var t=e.srcControl;var n;if(t instanceof s){n=t.getSuggestionText();m._suggestionItemTapped=true;f.close();window.setTimeout(function(){l._updateValue(n);l._fireChangeEvent();l.fireSearch({query:n,suggestionItem:t,refreshButtonPressed:false,clearButtonPressed:false})},0)}}function S(){var e,i,s,o,r,u;s=new(sap.ui.require("sap/m/SearchField"))({liveChange:function(e){var t=e.getParameter("newValue");l._updateValue(t);l.fireLiveChange({newValue:t});l.fireSuggest({suggestValue:t});m.update()},search:function(t){if(!t.getParameter("clearButtonPressed")){e.close()}}});u=new n({icon:"sap-icon://decline",press:function(){m._cancelButtonTapped=true;e._oCloseTrigger=true;e.close();l._updateValue(i)}});o=new t({content:[s,u]});r=new n({text:a.getLibraryResourceBundle("sap.m").getText("MSGBOX_OK"),press:function(){e.close()}});e=new(sap.ui.require("sap/m/Dialog"))({stretch:true,customHeader:o,content:w(),beginButton:r,beforeClose:function(){l._bSuggestionSuppressed=true},beforeOpen:function(){i=l.getValue();s._updateValue(i)},afterClose:function(e){if(!m._cancelButtonTapped&&!m._suggestionItemTapped){l._fireChangeEvent();l.fireSearch({query:l.getValue(),refreshButtonPressed:false,clearButtonPressed:false})}}});e.addEventDelegate({ontap:v},l);return e}function _(){var e=m._oPopover=new(sap.ui.require("sap/m/Popover"))({showArrow:false,showHeader:false,horizontalScrolling:false,placement:c.Vertical,offsetX:0,offsetY:0,initialFocus:p,bounce:false,ariaLabelledBy:u.getStaticId("sap.m","INPUT_AVALIABLE_VALUES"),afterOpen:function(){l._applySuggestionAcc()},beforeClose:function(){l.$("I").removeAttr("aria-activedescendant");l.$("SuggDescr").text("")},content:w()}).addStyleClass("sapMSltPicker").addStyleClass("sapMSltPicker-CTX");e.open=function(){return this.openBy(p)};e.addEventDelegate({onAfterRendering:m.setPopoverMinWidth.bind(m),ontap:v},l);return e}function w(){if(!d){d=new i({parentInput:p})}return d}function y(){if(f===undefined){f=h?S():_()}return f}this.setPopoverMinWidth=function(){var e=m._oPopover.getDomRef();if(e){var t=l.$().outerWidth()/parseFloat(r.BaseFontSize)+"rem";e.style.minWidth=t}};this.destroy=function(){if(f){f.close();f.destroy();f=null}if(d){d.destroy();d=null}};this.close=function(){if(!h&&this.isOpen()){f.close()}};this.open=function(){if(!this.isOpen()){this.setSelected(-1);this._suggestionItemTapped=false;this._cancelButtonTapped=false;y().open()}};this.update=function(){var e=w();window.clearTimeout(g);if(this.isOpen()){g=window.setTimeout(e.update.bind(e),50);l._applySuggestionAcc()}};this.isOpen=function(){return!!f&&f.isOpen()};this.getSelected=function(){return w().getSelectedItemIndex()};this.setSelected=function(e,t){return w().selectByIndex(e,t)}}return l},true);