/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/qunit/QUnitUtils","sap/ui/test/Opa5","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ui/test/_OpaLogger"],function(t,e,i,r,n,o){"use strict";return t.extend("sap.ui.test.actions.Action",{metadata:{properties:{idSuffix:{type:"string"}},publicMethods:["executeOn"]},executeOn:function(){return true},$:function(t){var e;var i="";if(this.getIdSuffix()){e=t.$(this.getIdSuffix());i=e.length?"":"DOM representation of control '"+t+"' has no element with user-provided ID suffix '"+this.getIdSuffix()+"'"}else{var r=this._getAdapter(t);if(r){e=t.$(r);i=e.length?"":"DOM representation of control '"+t+"' has no element with ID suffix '"+r+"' which is the default adapter for '"+this.getMetadata().getName()+"'"}if(!e||!e.length){e=n(t.getFocusDomRef());if(!e.length){e=t.$();if(!e.length){i+="DOM representation of control '"+t+"' has no focus DOM reference"}}}}if(e.length){this.oLogger.info("Found a DOM reference for the control '"+t+"'. Executing '"+this.getMetadata().getName()+"' on the DOM element with ID '"+e[0].id+"'");return e}else{this.oLogger.error(i);throw new Error(i)}},getUtils:function(){return i.getUtils()||e},init:function(){this.controlAdapters={};this.oLogger=o.getLogger(this.getMetadata().getName())},dropPosition:{BEFORE:"BEFORE",AFTER:"AFTER",CENTER:"CENTER"},_getAdapter:function(t){var e=function(i){var r=this.controlAdapters[i.getName()];if(r){if(typeof r==="function"){return r(t)}if(typeof r==="string"){return r}}var n=i.getParent();if(n){return e(n)}return null}.bind(this);return e(t.getMetadata())},_tryOrSimulateFocusin:function(t,e){var i=t[0];var n=false;var o=this._isFocused(i);var a=r.browser.firefox&&r.browser.version>=60;if(o||a){n=true}else{t.trigger("focus");var s=this._isFocused(i);n=!s}if(n){this.oLogger.debug("Control "+e+" could not be focused - maybe you are debugging?");this._createAndDispatchFocusEvent("focusin",i);this._createAndDispatchFocusEvent("focus",i);this._createAndDispatchFocusEvent("activate",i)}if(!this._isFocused(i)){this.oLogger.trace("Control "+e+" could not be focused-in correctly. This may lead to lost interactions with the control")}},_simulateFocusout:function(t){this._createAndDispatchFocusEvent("focusout",t);this._createAndDispatchFocusEvent("blur",t);this._createAndDispatchFocusEvent("deactivate",t)},_createAndDispatchMouseEvent:function(t,e){var i=0;var r;r=new MouseEvent(t,{bubbles:true,cancelable:true,identifier:1,target:e,radiusX:1,radiusY:1,rotationAngle:0,button:i,type:t});e.dispatchEvent(r)},_createAndDispatchFocusEvent:function(t,e){var i,r=["focusin","focusout","activate","deactivate"].indexOf(t)!==-1;i=new FocusEvent(t,{type:t,target:e,curentTarget:e,bubbles:r});e.dispatchEvent(i);this.oLogger.info("Dispatched focus event: '"+t+"'")},_createAndDispatchDragEvent:function(t,e,i){var r=this._getEventCoordinates(e,i);var n=new DataTransfer;var o;o=new DragEvent(t,{type:t,eventPhase:3,bubbles:true,cancelable:true,defaultPrevented:false,composed:true,returnValue:true,cancelBubble:false,target:e,toElement:e,srcElement:e,radiusX:1,radiusY:1,rotationAngle:0,clientX:r.x,clientY:r.y,dataTransfer:n});e.dispatchEvent(o)},_getEventCoordinates:function(t,e){var i=n(t);var r=i.offset();var o={x:r.left+i.outerWidth()/2,y:r.top+i.outerHeight()/2};if(!e){return o}switch(e.position){case this.dropPosition.BEFORE:return{x:r.left,y:r.top};case this.dropPosition.AFTER:return{x:r.left+i.outerWidth(),y:r.top+i.outerHeight()};case this.dropPosition.CENTER:default:return o}},_isFocused:function(t){var e=t===document.activeElement;var i=!document.hasFocus||document.hasFocus();var r=!!(t.type||t.href||~t.tabIndex);return e&&i&&r}})});