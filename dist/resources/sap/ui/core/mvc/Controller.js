/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/base/util/extend","sap/ui/base/EventProvider","sap/ui/base/ManagedObject","sap/ui/core/mvc/ControllerMetadata","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/ControllerExtensionProvider","sap/ui/core/mvc/OverrideExecution","sap/base/Log"],function(e,t,n,r,o,i,a,s,l){"use strict";var u={};var f=n.extend("sap.ui.core.mvc.Controller",{metadata:{stereotype:"controller",methods:{byId:{public:true,final:true},getView:{public:true,final:true},getInterface:{public:false,final:true},onInit:{public:false,final:false,overrideExecution:s.After},onExit:{public:false,final:false,overrideExecution:s.Before},onBeforeRendering:{public:false,final:false,overrideExecution:s.Before},onAfterRendering:{public:false,final:false,overrideExecution:s.After}}},constructor:function(e){var r=null;if(typeof e=="string"){if(!u[e]){l.warning("Do not call sap.ui.core.mvc.Controller constructor for non typed scenario!")}r=u[e]}n.apply(this,arguments);if(r){t(this,u[e])}if(this.extension){throw new Error("The keyword 'extension' cannot be used as a member of a controller")}this["_sapui_Extensions"]={};f.extendByMember(this,false);this._sapui_isExtended=false},_isExtended:function(){return this._sapui_isExtended},getInterface:function(){var e={};var t=this.getMetadata();var n=t.getAllPublicMethods();n.forEach(function(t){var n=this[t];if(typeof n==="function"){e[t]=function(){var e=n.apply(this,arguments);return e instanceof f?e.getInterface():e}.bind(this)}}.bind(this));this.getInterface=function(){return e};return e}},o);function c(t,n,r){var o=n.getMetadata().getName();var a=t.getMetadata();var s=t["_sapui_Extensions"];var u=t.getInterface();var f=i.getMetadata().getLifecycleConfiguration();var c={namespace:o,extension:n,reloadNeeded:false};n._setController(u);if(n.getMetadata().hasOverrides()){var d,p,g,v,h=n.getMetadata().getOverrides(),x=n.getMetadata().getStaticOverrides();for(v in x){g=n.getMetadata();if(!g.isMethodFinal(v)){i.overrideMethod(v,n,x,n,g.getOverrideExecution(v))}else{l.error("Method '"+v+"' of extension '"+o+"' is flagged final and cannot be overridden by calling 'override'")}}for(v in h){if(v!=="extension"){if(v in n.base){l.debug("Overriding  member '"+v+"' of original controller.");var y=h[v];var E=t[v];if(typeof E=="object"&&typeof y=="object"){p=s[v];g=p.extension.getMetadata();for(d in y){if(!g.isMethodFinal(d)){i.overrideMethod(d,E,y,n,g.getOverrideExecution(d))}else{l.error("Method '"+d+"' of extension '"+p.namespace+"' is flagged final and cannot be overridden by extension '"+o+"'")}}}else if(!a.isMethodFinal(v)){i.overrideMethod(v,t,h,n,a.getOverrideExecution(v))}else{l.error("Method '"+v+"' of controller '"+t.getMetadata().getName()+"' is flagged final and cannot be overridden by extension '"+o+"'")}}else if(v in f){i.overrideMethod(v,t,h,n,a.getOverrideExecution(v))}else{l.error("Method '"+v+"' does not exist in controller "+t.getMetadata().getName()+" and cannot be overridden")}}c.reloadNeeded=true}if(h&&h.extension){for(var b in h.extension){g=s[b].extension.getMetadata();var M=e.create(b,t.extension);var m=s[b].extension;var w=h.extension[b];for(d in w){if(!g.isMethodFinal(d)){i.overrideMethod(d,M,w,n,g.getOverrideExecution(d));i.overrideMethod(d,m,w,n,g.getOverrideExecution(d))}else{l.error("Method '"+d+"' of extension '"+b+"' is flagged final and cannot be overridden by extension '"+o+"'")}}}}}var C=n.getInterface();if(r){s[r]=c;c.location=r;t[r]=C;u[r]=C}else{s[o]=c;c.location="extension."+o;e.set("extension."+o,C,t);e.set("extension."+o,C,u)}}function d(e,t,n){if(t instanceof i){c(e,t,n)}else if(t.getMetadata&&t.getMetadata().getStereotype()=="controllerextension"){var r=new t;c(e,r,n)}else{var o=i.getMetadata().getLifecycleConfiguration();for(var a in t){if(a in o){i.overrideMethod(a,e,t,e,o[a].overrideExecution)}else{i.overrideMethod(a,e,t)}}}}function p(t,n){if(!t){throw new Error("Controller name ('sName' parameter) is required")}var r=t.replace(/\./g,"/")+".controller",o=i(sap.ui.require(r));function i(n){if(n){return n}else if(u[t]){return f}else{return e.get(t)}}if(n){return new Promise(function(e,t){if(!o){sap.ui.require([r],function(t){e(i(t))},t)}else{e(o)}})}else if(!o){o=sap.ui.requireSync(r);return i(o)}else{return o}}function g(e,t){var n;if(u[t]){n=new e(t)}else{n=new e}if(!n){throw new Error("Controller "+t+" couldn't be instantiated")}return n}f.extendByMember=function(e,t){var n;for(n in e){if(e[n]&&e[n].getMetadata&&e[n].getMetadata().getStereotype()=="controllerextension"){e[n]=new e[n]}}for(n in e){if(e[n]&&e[n].getMetadata&&e[n].getMetadata().getStereotype()=="controllerextension"){d(e,e[n],n)}}if(t){return Promise.resolve(e)}else{return e}};f.applyExtensions=function(e,t,n,r,o){function i(e,t){if(e){return p(t,true).then(function(e){e=u[t]||e;if(e!==undefined){if(e.getMetadata&&e.getMetadata().isA("sap.ui.core.mvc.Controller")){l.warning("Attempt to load Extension Controller "+t+" was not successful","Controller extension should be a plain object.",null,function(){return{type:"ControllerExtension",name:t}})}return e}},function(e){l.error("Attempt to load Extension Controller "+t+" was not successful - is the Controller correctly defined in its file?")})}else{if(!u[t]&&!sap.ui.require(t)){p(t)}if(u[t]!==undefined){return u[t]}else{l.error("Attempt to load Extension Controller "+t+" was not successful - is the Controller correctly defined in its file?",null,function(){return{type:"ControllerExtension",name:t}});return{}}}}if(o){return a.getControllerExtensions(t,n,r,o).then(function(t){var n=t.customizingControllerNames.map(function(e){return i(true,e)});return Promise.all(n).then(function(n){var r=n.concat(t.providerControllers);for(var o=0,i=r.length;o<i;o++){d(e,r[o])}return e})},function(t){l.error("Controller Extension Provider: Error '"+t+"' thrown in "+f._sExtensionProvider+"; extension provider ignored.");return e})}else{var s=a.getControllerExtensions(t,n,r,o);var c=s.customizingControllerNames.map(i.bind(null,false));var g=c.concat(s.providerControllers);for(var v=0,h=g.length;v<h;v++){d(e,g[v])}}return e};f.create=function(e){return v(e.name,undefined,true,e._viewId)};sap.ui.controller=function(e,t,n,r){if(n){l.info("Do not use deprecated factory function 'sap.ui.controller("+e+")'. Use 'sap.ui.core.mvc.Controller.create(...)' instead.","sap.ui.controller",null,function(){return{type:"sap.ui.controller",name:e}})}else{l.warning("Do not use synchronous controller creation for controller '"+e+"'! Use the new asynchronous factory 'sap.ui.core.mvc.Controller.create(...)' instead.","sap.ui.controller",null,function(){return{type:"sap.ui.controller",name:e}})}return v.apply(this,arguments)};function v(e,t,n,o){var i,a,s=r._sOwnerId;if(typeof t==="boolean"){t=undefined}if(!t){if(n){return p(e,n).then(function(t){return g(t,e)}).then(function(t){return f.applyExtensions(t,e,s,o,n)}).then(function(e){e._sapui_isExtended=true;return e})}else{a=p(e,n);i=g(a,e);i=f.applyExtensions(i,e,s,o,n);i._sapui_isExtended=true}return i}else{u[e]=t;l.info("For defining controllers use Controller.extend instead")}}f.prototype.getPublicMethods=function(){var e={},n=this.getMetadata(),r=n.getAllMethods(),o=n.getLifecycleConfiguration();Object.keys(r).forEach(function(t){if(n.isMethodPublic(t)){e[t]=r[t];e[t].reloadNeeded=!!(t in o)}});delete e.extension;var i=this["_sapui_Extensions"];Object.keys(i).forEach(function(n){var r=i[n];var o=r.extension.getInterface();var a=r.extension.getMetadata().getAllMethods();Object.keys(o).forEach(function(n){delete e[r.location];var o=t({},a[n],{reloadNeeded:r.reloadNeeded});e[r.location+"."+n]=o})});return e};f.prototype.destroy=function(){Object.keys(this["_sapui_Extensions"]).forEach(function(t){e.set(t.location,null,this)}.bind(this));delete this["_sapui_Extensions"];delete this["_sapui_Interface"];n.prototype.destroy.apply(this,arguments)};f.prototype.getView=function(){return this.oView};f.prototype.byId=function(e){return this.oView?this.oView.byId(e):undefined};f.prototype.createId=function(e){return this.oView?this.oView.createId(e):undefined};f.prototype.getOwnerComponent=function(){var e=sap.ui.requireSync("sap/ui/core/Component");return e.getOwnerComponentFor(this.getView())};f.prototype.connectToView=function(e){this.oView=e;if(this.onInit){e.attachAfterInit(this.onInit,this)}if(this.onExit){e.attachBeforeExit(this.onExit,this)}if(this.onAfterRendering){e.attachAfterRendering(this.onAfterRendering,this)}if(this.onBeforeRendering){e.attachBeforeRendering(this.onBeforeRendering,this)}};f._sExtensionProvider=null;f.registerExtensionProvider=function(e){f._sExtensionProvider=e;a.registerExtensionProvider(e)};return f});