/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/layout/cssgrid/GridLayoutBase","sap/ui/layout/cssgrid/GridSettings","sap/ui/layout/cssgrid/GridBoxLayoutStyleHelper","sap/ui/Device","sap/ui/thirdparty/jquery"],function(t,e,i,a,o){"use strict";var s=/^([X][L](?:[1-9]|1[0-2]))? ?([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var r=s.exec("XL7 L6 M4 S2");var n={Phone:"sapUiLayoutCSSGridBoxLayoutSizeS",Tablet:"sapUiLayoutCSSGridBoxLayoutSizeM",Desktop:"sapUiLayoutCSSGridBoxLayoutSizeL",LargeDesktop:"sapUiLayoutCSSGridBoxLayoutSizeXL"};var p={XL:"sapUiLayoutCSSGridBoxLayoutSpanXL7",L:"sapUiLayoutCSSGridBoxLayoutSpanL6",M:"sapUiLayoutCSSGridBoxLayoutSpanM4",S:"sapUiLayoutCSSGridBoxLayoutSpanS2"};var l="0.5rem";var u=t.extend("sap.ui.layout.cssgrid.GridBoxLayout",{metadata:{library:"sap.ui.layout",properties:{boxMinWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxesPerRowConfig:{type:"sap.ui.layout.BoxesPerRowConfig",group:"Behavior",defaultValue:"XL7 L6 M4 S2"}}}});u.prototype.getActiveGridSettings=function(){return new e({gridTemplateColumns:this._getTemplateColumns(),gridGap:l+" "+l})};u.prototype._applySingleGridLayout=function(e){t.prototype._applySingleGridLayout.call(this,e);var i=sap.ui.getCore().byId(e.parentElement.id);if(i&&i.isA("sap.f.GridList")&&i.isGrouped()){this._flattenHeight(i)}};u.prototype.addGridStyles=function(e){t.prototype.addGridStyles.apply(this,arguments);this._addSpanClasses(e);e.class("sapUiLayoutCSSGridBoxLayoutContainer")};u.prototype.onGridAfterRendering=function(t){t.getGridDomRefs().forEach(function(t){if(t.children){for(var e=0;e<t.children.length;e++){if(!t.children[e].classList.contains("sapMGHLI")&&!t.children[e].classList.contains("sapUiBlockLayerTabbable")){t.children[e].classList.add("sapUiLayoutCSSGridItem")}}}});if(!this._hasBoxWidth()){this._applySizeClass(t)}if(t.isA("sap.f.GridList")&&t.getGrowing()){var e=t._oGrowingDelegate._onAfterPageLoaded;t._oGrowingDelegate._onAfterPageLoaded=function(){e.call(t._oGrowingDelegate);if(t.isA("sap.f.GridList")&&t.isGrouped()){this._flattenHeight(t)}}.bind(this)}};u.prototype.isResponsive=function(){return true};u.prototype.onGridResize=function(t){if(t.control&&t.control.isA("sap.f.GridList")&&t.control.isGrouped()){this._flattenHeight(t.control)}if(t){if(!this._hasBoxWidth()){this._applySizeClass(t.control)}}};u.prototype._flattenHeight=function(t){var e=0;t.$().removeClass("sapUiLayoutCSSGridBoxLayoutFlattenHeight");this._loopOverGridItems(t,function(t){e=Math.max(o(t).outerHeight(),e)});i.setItemHeight(t.getId(),e);t.$().addClass("sapUiLayoutCSSGridBoxLayoutFlattenHeight")};u.prototype._applySizeClass=function(t){var e=a.media.getCurrentRange("StdExt",t.$().width()),i=n[e.name];t.getGridDomRefs().forEach(function(t){if(!t.classList.contains(i)){Object.keys(n).map(function(e){t.classList.remove(n[e])});t.classList.add(i)}})};u.prototype._getTemplateColumns=function(){var t="";if(this.getBoxWidth()){t="repeat(auto-fit, "+this.getBoxWidth()+")"}else if(this.getBoxMinWidth()){t="repeat(auto-fit, minmax("+this.getBoxMinWidth()+", 1fr))"}return t};u.prototype._hasBoxWidth=function(){if(this.getBoxWidth()||this.getBoxMinWidth()){return true}else{return false}};u.prototype._addSpanClasses=function(t){var e,i=this.getBoxesPerRowConfig(),a,o,n,l;if(this._hasBoxWidth()){return}if(!i||!i.length===0){e=r}else{e=s.exec(i)}if(e){for(var u=1;u<e.length;u++){var d=e[u];if(!d){continue}d=d.toUpperCase();switch(d.substr(0,1)){case"X":if(d.substr(1,1)==="L"){a=this._getBoxesPerRowClass(d,2)}break;case"L":o=this._getBoxesPerRowClass(d,1);break;case"M":n=this._getBoxesPerRowClass(d,1);break;case"S":l=this._getBoxesPerRowClass(d,1);break;default:break}}}a=a||p.XL;o=o||p.L;n=n||p.M;l=l||p.S;t.class(a).class(o).class(n).class(l)};u.prototype._getBoxesPerRowClass=function(t,e){var i=parseInt(t.substr(e,t.length));if(i&&i>0&&i<13){return"sapUiLayoutCSSGridBoxLayoutSpan"+t}};u.prototype._loopOverGridItems=function(t,e){t.getGridDomRefs().forEach(function(t){if(t&&t.children){for(var i=0;i<t.children.length;i++){if(t.children[i].style.display!=="none"&&t.children[i].style.visibility!=="hidden"){e(t.children[i])}}}})};return u});