/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./FormElement","sap/ui/layout/library"],function(e,t){"use strict";var i=e.extend("sap.ui.layout.form.SemanticFormElement",{metadata:{library:"sap.ui.layout",properties:{delimiter:{type:"string",group:"Data",defaultValue:"/"}},aggregations:{fieldLabels:{type:"sap.ui.core.Label",multiple:true},_delimiters:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},_displayField:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}}});i.prototype.init=function(){e.prototype.init.apply(this,arguments);this._oObserver.observe(this,{properties:["_editable","delimiter"],aggregations:["fieldLabels"]})};i.prototype.exit=function(){e.prototype.exit.apply(this,arguments)};i.prototype.enhanceAccessibilityState=function(t,i){var r=this.getAggregation("delimiters",[]);if(r.indexOf(t)<0){if(this.getProperty("_editable")){var a=this.indexOfField(t);if(a>=0){var l=this.getFieldLabels();var o=l[a];if(o){var s;if(typeof o==="string"){s=o}else{s=o.getText()}var n=i["label"];if(!n){n=s}else{n=n+" "+s}i["label"]=n;var g=i["labelledby"];if(g){o=this.getLabelControl();var f=g.split(" ");a=f.indexOf(o.getId());if(a>=0){f.splice(a,1);g=f.join(" ")}i["labelledby"]=g}return i}}}}return e.prototype.enhanceAccessibilityState.apply(this,arguments)};i.prototype.onLayoutDataChange=function(t){var i=t.srcControl;var r=i.getLayoutData();if(!r||!r._bSetBySemanticFormElement){d.call(this)}e.prototype.onLayoutDataChange.apply(this,arguments)};i.prototype.getFieldsForRendering=function(){var e=[];if(!this._bLayoutDataCreated){d.call(this)}if(this.getProperty("_editable")){var t=this.getFields();var i=this.getAggregation("_delimiters",[]);for(var r=0;r<t.length;r++){var a=t[r];e.push(a);if(r<t.length-1&&i[r]){e.push(i[r])}}}else{var l=this.getAggregation("_displayField");if(l){e.push(l)}}return e};i.prototype._observeChanges=function(t){e.prototype._observeChanges.apply(this,arguments);if(t.object===this){if(t.name==="fields"){a.call(this,t.child,t.mutation)}else if(t.name==="_editable"){r.call(this,t.current)}else if(t.name==="delimiter"){l.call(this,t.current)}else if(t.name==="fieldLabels"){o.call(this,t.mutation,t.child)}}else{if(t.object.isA("sap.ui.core.Label")){n.call(this,t)}else{s.call(this,t)}}};function r(e){if(e){this.destroyAggregation("_displayField");g.call(this)}else{this.destroyAggregation("_delimiters");p.call(this)}}function a(e,t){if(t==="insert"){if(!e.isA("sap.ui.core.IFormContent")||!e.isA("sap.ui.core.ISemanticFormContent")){throw new Error(e+" is not valid Form content. "+this)}if(e.getFormValueProperty){this._oObserver.observe(e,{properties:[e.getFormValueProperty()]})}else if(e.getMetadata().getProperty("value")){this._oObserver.observe(e,{properties:["value"]})}else if(e.getMetadata().getProperty("text")){this._oObserver.observe(e,{properties:["text"]})}}else{var i=e.getLayoutData();if(i&&i._bSetBySemanticFormElement){i.destroy()}}if(this.getProperty("_editable")){g.call(this)}else{p.call(this,true)}}function l(e){if(this.getProperty("_editable")){g.call(this)}else{h.call(this,false)}c.call(this)}function o(e,t){if(typeof t!=="string"){if(e==="insert"){this._oObserver.observe(t,{properties:["text"]})}else{this._oObserver.unobserve(t)}}c.call(this)}function s(e){var t=e.object.getFormValueProperty?e.object.getFormValueProperty():null;if(e.name===t||e.name==="value"||e.name==="text"){if(!this.getProperty("_editable")){h.call(this,false)}}}function n(e){c.call(this)}function g(){var e=this.getFields();var i=this.getAggregation("_delimiters",[]);var r=this.getDelimiter();var a=this.getId()+"-delimiter-";var l=0;for(l=0;l<e.length;l++){if(l<e.length-1){if(i.length>l){t.form.FormHelper.updateDelimiter(i[l],r)}else{var o=t.form.FormHelper.createDelimiter(r,a+l);this.addAggregation("_delimiters",o)}}}if(i.length>0&&i.length>e.length-1){for(l=e.length-1;l<i.length;l++){i[l].destroy()}}d.call(this)}var f={onBeforeRendering:function(){h.call(this,true)}};function p(e){var i=this.getAggregation("_displayField");if(i){h.call(this,false)}else{var r=this.getId()+"-display";i=t.form.FormHelper.createSemanticDisplayControl("",r);i.addDelegate(f,true,this);this.setAggregation("_displayField",i)}}function h(e){var i=this.getAggregation("_displayField");if(i&&(i.getDomRef()||e)){if(e&&i._bNoForceUpdate){i._bNoForceUpdate=false;return}var r=this.getFields();var a=[];var l=false;for(var o=0;o<r.length;o++){var s=r[o];var n=s.getFormValueProperty?s.getFormValueProperty():null;var g;if(s.getFormFormattedValue){g=s.getFormFormattedValue();if(g instanceof Promise){l=true}}else if(n){g=s.getProperty(n)}else if(s.getMetadata().getProperty("value")){g=s.getValue()}else if(s.getMetadata().getProperty("text")){g=s.getText()}a.push(g)}i._bNoForceUpdate=true;if(l){Promise.all(a).then(function(e){var i=this.getAggregation("_displayField");var r=u.call(this,e);i._bNoForceUpdate=true;t.form.FormHelper.updateSemanticDisplayControl(i,r)}.bind(this))}else{var f=u.call(this,a);t.form.FormHelper.updateSemanticDisplayControl(i,f)}}else if(i&&i._bNoForceUpdate){i._bNoForceUpdate=false}}function u(e){var t=this.getDelimiter();var i="";for(var r=0;r<e.length;r++){i=i+e[r];if(r<e.length-1){i=i+" "+t+" "}}return i}function c(){if(!this.getLabel()){var e=this.getFieldLabels();var t=[];for(var i=0;i<e.length;i++){var r=e[i];if(typeof r==="string"){t.push(r)}else{t.push(r.getText())}}var a=u.call(this,t);this._setInternalLabel(a)}}function d(){var e=this.getFields();var t=this.getAggregation("_delimiters",[]);var i=this.getParent();var r=i&&i.getParent();var a=r&&r.getLayout();var l;var o=0;if(!a||!a.getLayoutDataForDelimiter){return}if(this.getProperty("_editable")){for(o=0;o<t.length;o++){var s=t[o];if(!s.getLayoutData()){l=a.getLayoutDataForDelimiter();if(l){if(l instanceof Promise){l.then(function(e){e._bSetBySemanticFormElement=true;this.setLayoutData(e)}.bind(s))}else if(l.isA("sap.ui.core.LayoutData")){l._bSetBySemanticFormElement=true;s.setLayoutData(l)}}}}if(e.length>1){for(o=0;o<e.length;o++){var n=e[o];l=n.getLayoutData();if(!l||l._bSetBySemanticFormElement){l=a.getLayoutDataForSemanticField(e.length,o+1,l);if(l){if(l instanceof Promise){l.then(function(e){e._bSetBySemanticFormElement=true;this.setLayoutData(e)}.bind(n))}else if(l.isA("sap.ui.core.LayoutData")&&!l._bSetBySemanticFormElement){l._bSetBySemanticFormElement=true;n.setLayoutData(l)}}}}}this._bLayoutDataCreated=true}}return i});